-- Entity name: montgomery_multiplier_tb
-- Author: Stephen Carter, Jacob Barnett
-- Contact: stephen.carter@mail.mcgill.ca, jacob.barnett@mail.mcgill.ca
-- Date: April 07, 2016
-- Description:
-- 	Testbench used to test the Montgomery Multiplier
--		Tests autogenerated from a python script

library ieee;
use IEEE.std_logic_1164.all;
--use IEEE.std_logic_arith.all;
--use IEEE.std_logic_unsigned.all;
use IEEE.numeric_std.all;


entity montgomery_multiplier_tb is
end entity;

architecture test of montgomery_multiplier_tb is
-- define the ALU compontent to be tested
Component montgomery_multiplier is
 	Generic(
		WIDTH_IN : integer := 32
	);
	Port(	A :	in unsigned(WIDTH_IN-1 downto 0);
		B :	in unsigned(WIDTH_IN-1 downto 0);
		N :	in unsigned(WIDTH_IN-1 downto 0);
		latch : in std_logic;
		clk :	in std_logic;
		reset :	in std_logic;
		M : 	out unsigned(WIDTH_IN-1 downto 0)
	);
end component;

CONSTANT WIDTH_IN : integer := 32;

CONSTANT clk_period : time := 1 ns;

Signal N_in : unsigned(WIDTH_IN-1 downto 0) := (others => '0');
Signal A_in : unsigned(WIDTH_IN-1 downto 0) := (others => '0');
Signal B_in : unsigned(WIDTH_IN-1 downto 0) := (others => '0');

Signal clk : std_logic := '0';
Signal reset_t : std_logic := '0';
Signal latch_in : std_logic := '0';

Signal M_out : unsigned(WIDTH_IN-1 downto 0) := (others => '0');

Begin
-- device under test
dut: montgomery_multiplier PORT MAP(	A	=> 	A_in,
					B 	=> 	B_in,
					N 	=> 	N_in,
					latch	=>	latch_in,
					clk	=> 	clk,
					reset 	=>	reset_t,
					M	=>	M_out);
  
-- process for clock
clk_process : Process
Begin
	clk <= '0';
	wait for clk_period/2;
	clk <= '1';
	wait for clk_period/2;
end process;

stim_process: process
Begin


	reset_t <= '1';
	wait for 1 * clk_period;
	reset_t <= '0';
	wait for 1 * clk_period;


	REPORT "Begin test case for a=1720455845 (A=2803127229), b=1720455845 (B=2803127229), N=4217499347";
	REPORT "Expected output is 671361430, 00101000000001000010100110010110";
	A_in <= "10100111000101000101001110111101";
	B_in <= "10100111000101000101001110111101";
	N_in <= "11111011011000011110111011010011";
	latch_in <= '1';
	wait for 2 * clk_period;
	latch_in <= '0';
	wait for 33 * clk_period;
	ASSERT(M_out = "00101000000001000010100110010110") REPORT "test failed" SEVERITY ERROR;

--	REPORT "Begin test case for a=1237264818 (A=143623779), b=1237264818 (B=143623779), N=2768318477";
--	REPORT "Expected output is 1883533697, 01110000010001000111000110000001";
--	A_in <= "00001000100011111000011001100011";
--	B_in <= "00001000100011111000011001100011";
--	N_in <= "10100101000000010011000000001101";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "01110000010001000111000110000001") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1419721302 (A=589271745), b=1419721302 (B=589271745), N=2239947583";
--	REPORT "Expected output is 2033352696, 01111001001100100111111111111000";
--	A_in <= "00100011000111111001001011000001";
--	B_in <= "00100011000111111001001011000001";
--	N_in <= "10000101100000101110001100111111";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "01111001001100100111111111111000") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1127446301 (A=1674325074), b=1127446301 (B=1674325074), N=2844822503";
--	REPORT "Expected output is 2126365020, 01111110101111011100000101011100";
--	A_in <= "01100011110011000010110001010010";
--	B_in <= "01100011110011000010110001010010";
--	N_in <= "10101001100100001000101111100111";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "01111110101111011100000101011100") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1090390223 (A=1598946371), b=1090390223 (B=1598946371), N=3435196657";
--	REPORT "Expected output is 317579240, 00010010111011011101111111101000";
--	A_in <= "01011111010011011111110001000011";
--	B_in <= "01011111010011011111110001000011";
--	N_in <= "11001100110000001111000011110001";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "00010010111011011101111111101000") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1773024287 (A=1087948093), b=1773024287 (B=1087948093), N=2693660833";
--	REPORT "Expected output is 758056473, 00101101001011110000011000011001";
--	A_in <= "01000000110110001100010100111101";
--	B_in <= "01000000110110001100010100111101";
--	N_in <= "10100000100011100000000010100001";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "00101101001011110000011000011001") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1352521476 (A=2137476384), b=1352521476 (B=2137476384), N=2251574789";
--	REPORT "Expected output is 1725788302, 01100110110111010111000010001110";
--	A_in <= "01111111011001110100110100100000";
--	B_in <= "01111111011001110100110100100000";
--	N_in <= "10000110001101000100111000000101";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "01100110110111010111000010001110") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1393739179 (A=280851592), b=1393739179 (B=280851592), N=2580311597";
--	REPORT "Expected output is 1938044061, 01110011100001000011010010011101";
--	A_in <= "00010000101111010111010010001000";
--	B_in <= "00010000101111010111010010001000";
--	N_in <= "10011001110011000110111000101101";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "01110011100001000011010010011101") REPORT "test failed" SEVERITY ERROR;
--
--	REPORT "Begin test case for a=1791328573 (A=1572613095), b=1791328573 (B=1572613095), N=2231595131";
--	REPORT "Expected output is 122030403, 00000111010001100000100101000011";
--	A_in <= "01011101101111000010101111100111";
--	B_in <= "01011101101111000010101111100111";
--	N_in <= "10000101000000110111000001111011";
--	latch_in <= '1';
--	wait for 2 * clk_period;
--	latch_in <= '0';
--	wait for 33 * clk_period;
--	ASSERT(M_out = "00000111010001100000100101000011") REPORT "test failed" SEVERITY ERROR;



	wait;

end process;
end architecture;

